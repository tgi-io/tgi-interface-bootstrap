(function(){"use strict";var t={CORE:function(){return{version:"0.4.48",Application:m,Attribute:e,Command:o,Delta:r,Interface:n,List:i,Log:v,MemoryStore:k,Message:a,Model:s,Presentation:g,Procedure:l,REPLInterface:f,Request:c,Session:b,Store:h,Text:u,Transport:d,User:y,View:p,Workspace:w,inheritPrototype:D,getInvalidProperties:C,getConstructorFromModelType:q,createModelFromModelType:M,getObjectFromCPON:P,trim:S,ltrim:I,rtrim:O,left:_,center:x,right:T,lpad:L,rpad:B,cpad:A,contains:E}}};function e(t,o){var r,n,i;if(!1==this instanceof e)throw new Error("new operator required");if("string"==typeof t){var a=t;(t={}).name=a,"string"==typeof o&&(t.type=o)}t=t||{},this.name=t.name||null,this.label=t.label||t.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=t.type||"String",n=this.type,(i=n.split("("))[1]=parseInt(i[1]),r=i,this.type=r[0],this.hint=t.hint||{},void 0!==t.hidden&&(this.hidden=t.hidden),this.validationRule=t.validationRule||{};var s=[],l=["name","type","label","hint","hidden","value","validationRule"];switch(this.type){case"ID":case"Group":case"Object":s=C(t,l),this.value=t.value||null;break;case"String":s=C(t,l.concat(["placeHolder","quickPick","size"])),this.size=r[1]?r[1]:"number"==typeof t.size?t.size:t.size||50,this.value=t.value||null,t.quickPick&&(this.quickPick=t.quickPick),this.placeHolder=t.placeHolder||null;break;case"Date":s=C(t,l.concat("placeHolder")),this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Boolean":s=C(t,l),!1===t.value?this.value=!1:this.value=t.value||null;break;case"Number":s=C(t,l.concat("placeHolder")),0===t.value?this.value=0:this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Model":s=C(t,l),this.value=t.value||null,this.value instanceof e.ModelID&&(this.modelType=this.value.modelType);break;case"Table":s=C(t,l.concat("group")),this.value=t.value||null,this.group=t.group||null}for(var c=this.getObjectStateErrors(),h=0;h<s.length;h++)c.push("invalid property: "+s[h]);if(c.length>1)throw new Error("error creating Attribute: multiple errors");if(c.length)throw new Error("error creating Attribute: "+c[0]);this._eventListeners=[],this._errorConditions={}}function o(t){if(!1==this instanceof o)throw new Error("new operator required");var e;"function"==typeof t&&(t={type:"Function",contents:t}),t instanceof l&&(t={type:"Procedure",contents:t});var r=C(t=t||{},["name","description","type","contents","scope","timeout","theme","icon","bucket","presentationMode","location","images"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Command: multiple errors");if(n.length)throw new Error("error creating Command: "+n[0]);for(e in t)this[e]=t[e];if(this.name=this.name||"a command","string"!=typeof this.name)throw new Error("name must be string");if(void 0===this.description&&(this.description=this.name+" Command"),void 0===this.type&&(this.type="Stub"),!E(o.getTypes(),this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(e in this.contents)if(this.contents.hasOwnProperty(e)&&"string"!=typeof this.contents[e]&&!(this.contents[e]instanceof o))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof g))throw new Error("contents must be a Presentation");if(this.presentationMode=this.presentationMode||"View",!E(o.getPresentationModes(),this.presentationMode))throw new Error("Invalid presentationMode: "+this.presentationMode);break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof l))throw new Error("contents must be a Procedure");break;default:throw new TypeError}if(void 0!==this.scope&&!(this.scope instanceof s||this.scope instanceof i))throw new Error("optional scope property must be Model or List");if(void 0!==this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if(void 0!==this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if(void 0!==this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!E(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if(void 0!==this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!E(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function r(t){if(!1==this instanceof r)throw new Error("new operator required");if(!1==t instanceof e.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=t,this.attributeValues={}}function n(t){if(!1==this instanceof n)throw new Error("new operator required");var e;(t=t||{}).name=t.name||"(unnamed)",t.description=t.description||"a Interface",t.vendor=t.vendor||null;var o=C(t,["name","description","vendor"]),r=[];for(e=0;e<o.length;e++)r.push("invalid property: "+o[e]);if(r.length>1)throw new Error("error creating Interface: multiple errors");if(r.length)throw new Error("error creating Interface: "+r[0]);for(e in this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,t)this[e]=t[e]}e.ModelID=function(t){if(!1==this instanceof e.ModelID)throw new Error("new operator required");if(!1==t instanceof s)throw new Error("must be constructed with Model");var o=t.getShortName();o&&(this.name=o),this.value=t.get("id"),this.constructorFunction=t.constructor,this.modelType=t.modelType},e.ModelID.prototype.toString=function(){return this.name?this.modelType+" "+this.name:this.modelType+" "+this.value},e.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name+" = "+this.value},e.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var o in t)if(t.hasOwnProperty(o)&&"*"!=t[o]&&!E(["StateChange","Validate"],t[o]))throw new Error("Unknown command event: "+t[o]);return this._eventListeners.push({events:t,callback:e}),this},e.prototype.offEvent=function(){this._eventListeners=[]},e.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var o=this._eventListeners[e];(o.events.length&&"*"===o.events[0]||E(o.events,t))&&o.callback.call(this,t)}},e.prototype.get=function(){return this.value},e.prototype.set=function(t){if("Model"===this.type){if(!(t instanceof e.ModelID))throw new Error("set error: value must be Attribute.ModelID");this.value=t}else this.value=t;return this._emitEvent("StateChange"),this.value},e.prototype.coerce=function(t){var e,o=t;switch(this.type){case"String":return void 0===o?"":"boolean"!=typeof o||o?o?(o=t.toString()).length>this.size?o.substring(0,this.size):o:"":"false";case"Number":return void 0===o?0:o?("string"==typeof o?(e=(o=o.replace(/^\s+|\s+$/g,"")).split(" "),o=e.length?e[0]:"",o=Number(o.replace(/[^/0-9\ \.]+/g,""))):o=Number(o),o||0):0;case"Boolean":return void 0!==o&&("string"==typeof o?"Y"===(o=o.toUpperCase())||"YES"===o||"T"===o||"TRUE"===o||"1"===o:!!o);case"Date":return"string"==typeof o&&2==o.split("/").length&&(o=o+"/"+(new Date).getFullYear()),new Date(o)}throw Error("coerce cannot determine appropriate value")},e.prototype.getObjectStateErrors=function(){var t;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),E(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":default:break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof e.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(t in this.value)this.value.hasOwnProperty(t)&&(this.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof e)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(t in this.group.value)this.group.value.hasOwnProperty(t)&&(this.group.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var o=C(this.validationRule,["required","range","isOneOf","isValidModel"]);return o.length&&this.validationErrors.push("invalid validationRule: "+o),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},e.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");var e;for(e in this.getObjectStateErrors(),this._emitEvent("Validate"),this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?!1!==this.value&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},e.prototype.setError=function(t,e){if(e=e||"",!(t=t||""))throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},e.prototype.clearError=function(t){if(!(t=t||""))throw new Error("condition required");delete this._errorConditions[t]},e.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},e.getEvents=function(){return["StateChange","Validate"].slice(0)},o.prototype.toString=function(){return this.type+" Command: "+this.name},o.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var o in t)if(t.hasOwnProperty(o)&&"*"!=t[o]&&!E(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[o]))throw new Error("Unknown command event: "+t[o]);this._eventListeners.push({events:t,callback:e})},o.prototype._emitEvent=function(t,e){var o;for(o in this._eventListeners)if(this._eventListeners.hasOwnProperty(o)){var r=this._eventListeners[o];(r.events.length&&"*"===r.events[0]||E(r.events,t))&&r.callback.call(this,t,e)}},o.prototype.execute=function(t){var e,r=this,i=arguments;if(!r.type)throw new Error("command not implemented");if(!E(["Function","Procedure","Menu","Presentation"],r.type))throw new Error("command type "+r.type+" not implemented");if("Presentation"===r.type){if(!(r.contents instanceof g))throw new Error("contents must be a Presentation");if((e=r.contents.getObjectStateErrors()).length)throw e.length>1?new Error("error executing Presentation: multiple errors"):new Error("error executing Presentation: "+e[0]);if(!(t instanceof n))throw new Error("interface param required")}r._emitEvent("BeforeExecute");try{switch(r.type){case"Function":setTimeout(function(){r.status=0;try{r.contents.apply(r,i)}catch(t){r.error=t,r._emitEvent("Error",t),r._emitEvent("Completed"),r.status=-1}},0);break;case"Procedure":setTimeout(function(){r.status=0;for(var t=r.contents.tasks||[],e=0;e<t.length;e++){if("function"==typeof t[e]){var n=t[e];t[e]={requires:[-1],command:new o({type:"Function",contents:n})}}t[e].command._parentProcedure||(t[e].command._taskIndex=e,t[e].command._parentProcedure=r,t[e].command.onEvent("*",s)),t[e].command.status=void 0}a()},0);break;case"Menu":t.render(r,"View");break;case"Presentation":r.contents.preRenderCallback?r.contents.preRenderCallback(r,function(){t.render(r)}):t.render(r)}}catch(t){r.error=t,r._emitEvent("Error",t),r._emitEvent("Completed"),r.status=-1}function a(){for(var t=r.contents.tasks||[],e=0;e<t.length;e++){var o=!0;if(void 0===t[e].command.status){for(var n in t[e].requires){if("string"==typeof t[e].requires[n])for(var i=0;i<t.length;i++)t[i].label==t[e].requires[n]&&(!t[i].command.status||t[i].command.status<=0)&&(o=!1);if("number"==typeof t[e].requires[n])if(-1==t[e].requires[n])"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(o=!1);else{var a=t[e].requires[n];(!t[a].command.status||t[a].command.status<=0)&&(o=!1)}}o&&t[e].command.execute()}}}function s(t,e){var o=r.contents.tasks,n=!0;switch(t){case"Error":r._emitEvent("Error",e);break;case"Aborted":r.abort();break;case"Completed":for(var i in o)o.hasOwnProperty(i)&&(o[i].command.status&&0!==o[i].command.status||(n=!1));n?r.complete():a()}}r._emitEvent("AfterExecute")},o.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},o.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},o.prototype.restart=function(){this.status=void 0,this._emitEvent("Restarted"),this.execute()},o.getTypes=function(){return["Stub","Menu","Presentation","Function","Procedure"].slice(0)},o.getEvents=function(){return["BeforeExecute","AfterExecute","Error","Aborted","Completed"].slice(0)},o.getPresentationModes=function(){return["View","Edit","List"].slice(0)},n.prototype.toString=function(){return this.description},n.prototype.canMock=function(){return!0},n.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var o=this.mocks.shift();if("ok"!=o.type)if("yes"!=o.type&&"no"!=o.type&&"cancel"!=o.type)if("ask"!=o.type)if("choose"!=o.type){this.dispatch(o),this.mockPending=!0;var r=this;setTimeout(function(){r.doMock()},0)}else this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(n.firstMatch(o.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=o.value);else this.askcallback?(t=this.askcallback,delete this.askcallback,t(o.value)):(this.askPending=!0,this.askResponse=o.value);else{switch(o.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e)}else this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0}},n.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof c))throw new Error("missing request parameter");var e;for(t instanceof Array||(t=[t]),e=0;e<t.length;e++)if(!1==t[e]instanceof c)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},n.prototype.start=function(t,e,o){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof o)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=o},n.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},n.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},n.prototype.notify=function(t){if(!1==t instanceof a)throw new Error("Message required")},n.prototype.render=function(t,e){if(!1==t instanceof o)throw new Error("Command object required")},n.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.done=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.warn=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.err=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):this.okcallback=e},n.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},n.prototype.ask=function(t,o,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==o instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof r)throw new Error("callback required");this.askPending?(delete this.askPending,r(this.askResponse)):this.askcallback=r},n.prototype.choose=function(t,e,o){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof o)throw new Error("callback required");this.choosePending?(delete this.choosePending,o(n.firstMatch(this.chooseResponse,e))):(this.choosecallback=o,this.chooseChoices=e)},n.firstMatch=function(t,e){if(void 0!==t)for(var o=0;o<e.length;o++){var r=e[o].toLowerCase();if(_(r,t.length)==t.toLowerCase())return o}};var i=function(t){if(!1==this instanceof i)throw new Error("new operator required");if(t instanceof s)this.model=t;else{if(!(t instanceof p))throw new Error("argument required: model");this.view=t,this.model=this.view.primaryModel}this.attributes=t.attributes,this._items=[],this._itemIndex=-1};function a(t,e){if(!1==this instanceof a)throw new Error("new operator required");if(void 0===t)throw new Error("message type required");if(!E(a.getTypes(),t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}i.prototype.length=function(){return this._items.length},i.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},i.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.attributes.length;e++){var o=this.attributes[e].name.toUpperCase(),r=t.toUpperCase(),n=r.split("."),i=o==r;if(2==n.length){r=n[1];var a=n[0],s=this.attributes[e].model.modelType.toUpperCase();i=o==r&&a==s}if(i)return"Date"!=this.attributes[e].type||this._items[this._itemIndex][e]instanceof Date?this._items[this._itemIndex][e]:null===this._items[this._itemIndex][e]||void 0===this._items[this._itemIndex][e]?null:new Date(this._items[this._itemIndex][e])}},i.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var o=0;o<this.attributes.length;o++){var r=this.attributes[o].name.toUpperCase(),n=t.toUpperCase(),i=n.split("."),a=r==n;if(2==i.length){n=i[1];var s=i[0],l=this.attributes[o].model.modelType.toUpperCase();a=r==n&&s==l}if(a)return void(this._items[this._itemIndex][o]=e)}throw new Error("attribute not valid for list model")},i.prototype.addItem=function(t){var e,o=[];if(t)for(e in t.attributes)o.push(t.attributes[e].value);else for(e in this.attributes)o.push(void 0);return this._items.push(o),this._itemIndex=this._items.length-1,this},i.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},i.prototype.findItemByID=function(t){for(var e=this.moveFirst();e;){if(t==this._items[this._itemIndex][0])return!0;e=this.moveNext()}return!1},i.prototype.indexedItem=function(t){return!(this._items.length<1)&&(!(t<0)&&(!(t>=this._items.length)&&(this._itemIndex=t,!0)))},i.prototype.moveNext=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex+1)},i.prototype.movePrevious=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex-1)},i.prototype.moveFirst=function(){return!(this._items.length<1)&&this.indexedItem(0)},i.prototype.moveLast=function(){return!(this._items.length<1)&&this.indexedItem(this._items.length-1)},i.prototype.sort=function(t){var e,o=0;for(var r in t)e||(e=r);if(!e)throw new Error("sort order required");for(var n=1==t[e];o<this.attributes.length&&this.attributes[o].name!=e;)o++;this._items.sort(function(t,e){if(n){if(t[o]<e[o])return-1;if(t[o]>e[o])return 1}else{if(t[o]>e[o])return-1;if(t[o]<e[o])return 1}return 0})},a.prototype.toString=function(){return"Null"===this.type?this.type+" Message":this.type+" Message: "+this.contents},a.getTypes=function(){return["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"].slice(0)};var s=function(t){var o;if(!1==this instanceof s)throw new Error("new operator required");if(this.attributes=[new e("id","ID")],t=t||{},this.modelType=t.modelType||"Model",t.attributes)for(o in t.attributes)t.attributes.hasOwnProperty(o)&&this.attributes.push(t.attributes[o]);var r=C(t,["modelType","attributes"]),n=this.getObjectStateErrors();for(o=0;o<r.length;o++)n.push("invalid property: "+r[o]);if(n.length>1)throw new Error("error creating Model: multiple errors");if(n.length)throw new Error("error creating Model: "+n[0]);for(this._eventListeners=[],this._errorConditions={},o=0;o<this.attributes.length;o++)this.attributes[o].model=this};s._ModelConstructor={},s.prototype.toString=function(){return"a "+this.modelType},s.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},s.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var t=0;t<this.attributes.length;t++)0!==t||this.attributes[t]instanceof e&&"ID"==this.attributes[t].type||this.validationErrors.push("first attribute must be ID"),this.attributes[t]instanceof e||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},s.prototype.attribute=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e];throw new Error("attribute not found in model: "+t)},s.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].get()},s.prototype.getShortName=function(){for(var t=0;t<this.attributes.length;t++)if("String"==this.attributes[t].type)return this.attributes[t].get();return""},s.prototype.getLongName=function(){return this.getShortName()},s.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},s.prototype.set=function(t,e){for(var o=0;o<this.attributes.length;o++)if(this.attributes[o].name.toUpperCase()==t.toUpperCase())return this.attributes[o].set(e),void this._emitEvent("StateChange");throw new Error("attribute not valid for model")},s.prototype.validate=function(t){var e,o,r=this,n=0;if("function"!=typeof t)throw new Error("callback is required");for(o in r.getObjectStateErrors(),r._errorConditions)r._errorConditions.hasOwnProperty(o)&&r.validationErrors.push(r._errorConditions[o]);if(r.validationErrors.length)return r.validationMessage=r.validationErrors.length>0?r.validationErrors[0]:"",r._emitEvent("StateChange"),void t.call(r);for(e=0;e<r.attributes.length;e++)n++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&r.validationErrors.push("bush"),0===--n&&(r.validationErrors.length||r._emitEvent("Validate"),r.validationMessage=r.validationErrors.length>0?r.validationErrors[0]:"",r._emitEvent("StateChange"),t.call(r))})},0)}(r.attributes[e])},s.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var o in t)if(t.hasOwnProperty(o)&&"*"!=t[o]&&!E(["StateChange","Validate"],t[o]))throw new Error("Unknown command event: "+t[o]);return this._eventListeners.push({events:t,callback:e}),this},s.prototype._emitEvent=function(t,e){var o;for(o in this._eventListeners)if(this._eventListeners.hasOwnProperty(o)){var r=this._eventListeners[o];(r.events.length&&"*"===r.events[0]||E(r.events,t))&&r.callback.call(this,t,e)}},s.prototype.setError=function(t,e){if(e=e||"",!(t=t||""))throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},s.prototype.clearError=function(t){if(!(t=t||""))throw new Error("condition required");delete this._errorConditions[t]};var l=function(t){if(!1==this instanceof l)throw new Error("new operator required");var e;t instanceof Array&&(t={tasks:t});var o=C(t=t||{},["tasks","tasksNeeded","tasksCompleted"]),r=[];for(e=0;e<o.length;e++)r.push("invalid property: "+o[e]);if(r.length>1)throw new Error("error creating Procedure: multiple errors");if(r.length)throw new Error("error creating Procedure: "+r[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(r=this.getObjectStateErrors()){if(r.length>1)throw new Error("error creating Procedure: multiple errors");if(r.length)throw new Error("error creating Procedure: "+r[0])}};function c(t){if(!1==this instanceof c)throw new Error("new operator required");if("string"==typeof t){var e=t;(t={}).type=e}if(t=t||{},this.type=t.type||null,t.value&&(this.value=t.value),!this.type||"string"!=typeof this.type)throw new Error("Request type required");if("Command"===this.type)if(this.command=t.command||null,!(this.command instanceof o))throw new Error("command object required")}l.prototype.getObjectStateErrors=function(){var t,e,r,n;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var i=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var a=this.tasks[t];for(n=C(a,["label","command","requires","timeout"]),e=0;e<n.length;e++)i.push("invalid task["+t+"] property: "+n[e]);for(e in void 0!==a.label&&"string"!=typeof a.label&&i.push("task["+t+"].label must be string"),void 0===a.command||a.command instanceof o||i.push("task["+t+"].command must be a Command object"),void 0===a.requires&&(a.requires=-1),a.requires instanceof Array||(a.requires=[a.requires]),a.requires)if(a.requires.hasOwnProperty(e)&&null!==a.requires[e])switch(typeof a.requires[e]){case"string":var s=!1;for(r=0;!s&&r<this.tasks.length;r++)a.requires[e]==this.tasks[r].label&&(s=!0);if(!s)throw new Error("missing label: "+a.requires[e]);break;case"number":if(a.requires[e]>=this.tasks.length)throw new Error("missing task #"+a.requires[e]+" for requires in task["+t+"]");if(a.requires[e]<-1)throw new Error("task #"+a.requires[e]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]")}}return i.length?i:null},c.prototype.toString=function(){return"Command"===this.type?this.type+" Request: "+this.command:this.type+" Request"};var h=function(t){if(!1==this instanceof h)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=C(t,["name","storeType"]),o=[],r=0;r<e.length;r++)o.push("invalid property: "+e[r]);if(o.length>1)throw new Error("error creating Store: multiple errors");if(o.length)throw new Error("error creating Store: "+o[0])};function u(t){if(!1==this instanceof u)throw new Error("new operator required");this.contents=t||"",this._eventListeners=[]}function d(t,e){if(!1==this instanceof d)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var o=this;o.connected=!1,o.initialConnect=!0,o.location=t,""===o.location&&(o.location="http host"),o.socket=io.connect(t,{reconnection:!1}),o.socket.on("connect",function(){o.connected=!0,o.initialConnect=!1,e.call(o,new a("Connected",""))}),o.socket.on("connecting",function(){console.log("socket.io ("+o.location+") connecting")}),o.socket.on("error",function(t){var r="general error with "+o.location+(t?", reason "+t:"");console.error(r),o.initialConnect&&e.call(o,new a("Error",r))}),o.socket.on("connect_error",function(t){var r="connect error with "+o.location+(t?", reason "+t:"");console.error(r),o.initialConnect&&e.call(o,new a("Error",r))}),o.socket.on("connect_failed",function(t){var r="connect failed with "+o.location+(t?", reason "+t:"");console.error(r),o.initialConnect&&e.call(o,new a("Error",r))}),o.socket.on("message",function(t){o.rawCallBack?o.rawCallBack(t):console.log("socket.io ("+o.location+") message: "+t)}),o.socket.on("disconnect",function(t){o.connected=!1,console.log("socket.io ("+o.location+") disconnect: "+t)})}function p(t,o,r){if(!1==this instanceof p)throw new Error("new operator required");if(!(t instanceof s))throw new Error("argument must be a Model");if("object"!=typeof o)throw new Error("object expected");if(!(r instanceof Array))throw new Error("array of attributes expected");this.primaryModel=t,this.relatedModels=o,this.attributes=r;var n=new e("id","ID");for(var i in n.model=t,this.attributes.unshift(n),o)if(o.hasOwnProperty(i)){var a=o[i];if("object"!=typeof a)throw new Error("relatedModel key values expect object");if(void 0===a.id)throw new Error("relatedModel key values expect object with id key");if(void 0===a.model)throw new Error("relatedModel key values expect object with model key");if(!(a.id instanceof e))throw new Error("relatedModel id must be a Attribute");if(!(a.model instanceof s))throw new Error("relatedModel model must be a Model")}for(var l=0;l<r.length;l++){var c=r[l];if(!(c instanceof e))throw new Error("attribute array must contain Attributes");if(!(c.model instanceof s))throw new Error("attribute array must contain Attributes with model references")}}h.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},h.prototype.getServices=function(){return this.storeProperty},h.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},h.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},h.prototype.putModel=function(){throw new Error("Store does not provide putModel")},h.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},h.prototype.getList=function(){throw new Error("Store does not provide getList")},h.prototype.getViewList=function(t,e,o,r){var n,a,s,l=this;if("function"==typeof r?(n=r,a=o):n=o,!(t instanceof i))throw new Error("argument must be a List");if(!t.view)throw new Error("List is Model type use getList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof n)throw new Error("callback required");var c=new i(t.model);function h(e,o){if(t.clear(),void 0===o){var r=c.moveFirst(),i=[];a()}else n(t,o);function a(){if(r){for(t.addItem(),s=0;s<t.attributes.length;s++){var e=t.attributes[s];e.model==t.model&&t.set(e.name,c.get(e.name))}for(var o in i=[],t.view.relatedModels)t.view.relatedModels.hasOwnProperty(o)&&i.push(o);h()}else n(t)}function h(){if(!i.length)return r=c.moveNext(),void a();var e=i.shift(),o=t.view.relatedModels[e],s=c.get(o.id.name);o.model.set("id",s),l.getModel(o.model,function(e,o){if(void 0===o){for(var r=0;r<t.attributes.length;r++){var i=t.attributes[r];i.model==e&&t.set(e.modelType+"."+i.name,e.get(i.name))}h()}else n(o)})}}a?this.getList(c,e,a,h):this.getList(c,e,h)},u.prototype.toString=function(){return"Text: '"+(this.contents||"")+"'"},u.prototype.get=function(){return this.contents},u.prototype.set=function(t){return this.contents=t,this._emitEvent("StateChange"),this.contents},u.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var o=this._eventListeners[e];(o.events.length&&"*"===o.events[0]||E(o.events,t))&&o.callback.call(this,t)}},u.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var o in t)if(t.hasOwnProperty(o)&&"*"!=t[o]&&!E(["StateChange"],t[o]))throw new Error("Unknown command event: "+t[o]);return this._eventListeners.push({events:t,callback:e}),this},u.prototype.offEvent=function(){this._eventListeners=[]},d.showLog=!1,d.messageHandlers={},d.setMessageHandler=function(t,e){d.messageHandlers[t]=e},d.hostMessageProcess=function(t,e){d.showLog&&console.log("Transport.hostMessageProcess "+JSON.stringify(t)),d.messageHandlers[t.type]?d.messageHandlers[t.type](t.contents,e):e(!0)},d.prototype.sendRaw=function(t){this.socket.send(t)},d.prototype.onRaw=function(t){this.rawCallBack=t},d.prototype.send=function(t,e){var o=this;if(void 0===t)throw new Error("message required");if(!(t instanceof a))throw new Error("parameter must be instance of Message");if(void 0!==e&&"function"!=typeof e)throw new Error("argument must a callback");this.connected?void 0!==e?(d.showLog&&console.log("Transport emit "+JSON.stringify(t)),o.socket.emit("ackmessage",t,function(t){e.call(o,t)})):(d.showLog&&console.log("Transport send "+JSON.stringify(t)),o.socket.send(t)):e.call(o,new a("Error","not connected"))},d.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()},p.prototype.toString=function(){return this.primaryModel+" View"};var f=function(t){if(!1==this instanceof n)throw new Error("new operator required");var e;(t=t||{}).name=t.name||"(unnamed)",t.description=t.description||"a REPLInterface",t.vendor=t.vendor||null;var o=C(t,["name","description","vendor"]),r=[];for(e=0;e<o.length;e++)r.push("invalid property: "+o[e]);if(r.length>1)throw new Error("error creating Interface: multiple errors");if(r.length)throw new Error("error creating Interface: "+r[0]);for(e in this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.navStack=[],t)this[e]=t[e]};f.prototype=Object.create(n.prototype),f.prototype.toString=function(){return this.description},f.prototype.canMock=function(){return!0},f.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var o=this.mocks.shift();if("ok"!=o.type)if("yes"!=o.type&&"no"!=o.type&&"cancel"!=o.type)if("ask"!=o.type)if("choose"!=o.type){this.dispatch(o),this.mockPending=!0;var r=this;setTimeout(function(){r.doMock()},0)}else this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(n.firstMatch(o.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=o.value);else this.askcallback?(t=this.askcallback,delete this.askcallback,t(o.value)):(this.askPending=!0,this.askResponse=o.value);else{switch(o.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e)}else this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0}},f.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof c))throw new Error("missing request parameter");var e;for(t instanceof Array||(t=[t]),e=0;e<t.length;e++)if(!1==t[e]instanceof c)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},f.prototype.start=function(t,e,o){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof o)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=o,this.evaluateInput()},f.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},f.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},f.prototype.notify=function(t){if(!1==t instanceof a)throw new Error("Message required");this._Output(t)},f.prototype.render=function(t,r,n){if(!1==t instanceof g)throw new Error("Presentation object required");if("string"!=typeof r)throw new Error("presentationMode required");if(!E(o.getPresentationModes(),r))throw new Error("Invalid presentationMode: "+r);if(n&&"function"!=typeof n)throw new Error("optional second argument must a commandRequest callback function");var i,a,s=t.get("contents"),l=0;switch(r){case"View":for(i=0;i<s.length;i++)s[i]instanceof e&&s[i].label.length>l&&(l=s[i].label.length);for(i=0;i<s.length;i++)(a=s[i])instanceof e?this._Output(L(a.label,l)+": "+a.value):this._Output(a);break;case"Edit":for(this.editPresentationContents=s.slice();this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof e);){var c=this.editPresentationContents.shift();c instanceof o||this._Output(c)}this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e&&this._setPrompt(this.editPresentationContents[0].label+": "),this.editPresentationContents.length||delete this.editPresentationContents;break;default:throw new Error("presentationMode not handled: "+r)}},f.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");this._Output(t)},f.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this._Output(t),this.okPending?(delete this.okPending,e()):this.okcallback=e},f.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPrompt=t,this._setPrompt(this.yesnoPrompt),this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},f.prototype.ask=function(t,o,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==o instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof r)throw new Error("callback required");this.askPrompt=t,this._setPrompt(t),this.askPending?(delete this.askPending,r(this.askResponse)):this.askcallback=r},f.prototype.choose=function(t,e,o){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof o)throw new Error("callback required");this.choosePrompt=t,this._Output(t);for(var r=0;r<e.length;r++)this._Output("  "+e[r]);this._setPrompt("Choice? "),this.choosePending?(delete this.choosePending,o(n.firstMatch(this.chooseResponse,e))):(this.choosecallback=o,this.chooseChoices=e)},f.prototype.evaluateInput=function(t){var e=this;void 0===t&&(t=""),this._evaluateInput(t),setTimeout(function(){var t=e.application?e.application.get("brand"):"?";!e.promptText&&e.application&&e.application.primaryInterface&&e._ShowNav(),e.promptText&&(t=e.promptText,delete e.promptText),e.capturePromptcallback&&e.capturePromptcallback(t)},10)},f.prototype._evaluateInput=function(t){var r,i,a,s=(""+t).toUpperCase();if(this.okcallback)return r=this.okcallback,delete this.okcallback,void r();if(this.yesnocallback)return"Y"==s||"YES"==s?(r=this.yesnocallback,delete this.yesnocallback,void r(!0)):"N"==s||"NO"==s?(r=this.yesnocallback,delete this.yesnocallback,void r(!1)):0===t.length?(r=this.yesnocallback,delete this.yesnocallback,void r()):(this._Output("yes or no response required"),void this._setPrompt(this.yesnoPrompt));if(this.askcallback)return r=this.askcallback,delete this.askcallback,void r(t);if(this.choosecallback){r=this.choosecallback;var l=n.firstMatch(t,this.chooseChoices);if(l)delete this.choosecallback,r(l);else if(t.length>0){for(this.application.info('"'+t+'" not valid'),this._Output(this.choosePrompt),i=0;i<this.chooseChoices.length;i++)this._Output("  "+this.chooseChoices[i]);this._setPrompt("Choice? ")}else delete this.choosecallback,r()}else{if(this.editPresentationContents){if(!(this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e))throw this.editPresentationContents.length||delete this.editPresentationContents,new Error("editPresentationContents expected attribute");for(a=this.editPresentationContents.shift(),t.length&&(a.value=t);this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof e);)(a=this.editPresentationContents.shift())instanceof o||this._Output(a);return this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e&&this._setPrompt(this.editPresentationContents[0].label+": "),void(this.editPresentationContents.length||delete this.editPresentationContents)}if(this.presentation){var c=this.presentation.get("contents");for(this.navStack.length>0&&(c=this.navStack[this.navStack.length-1].contents),i=0;i<c.length;i++){var h=c[i];if(h instanceof o){var u=h.name.toUpperCase();if(t.length&&_(u,s.length)==s){switch(h.type){case"Stub":this.info(h.description+" not available.");break;case"Menu":this.navStack.push(h);break;case"Presentation":h.presentationMode="Edit",h.execute(this);break;default:h.execute()}return}}}t.length>0?this.application.info('"'+t+'" not valid'):this.navStack.pop()}else this._Output("input ignored: "+t)}},f.prototype._ShowNav=function(){var t,e=this.application?this.application.get("brand"):"?",r=this.presentation.get("contents"),n="",i="",a="";if(this.navStack.length>0){var s=this.navStack[this.navStack.length-1];for(n=s.name.replace(/\s/g,"")+": ",r=s.contents,t=0;t<this.navStack.length;t++)e+=" / "+this.navStack[t].name.replace(/\s/g,"")}for(t=0;t<r.length;t++){var l=r[t];l instanceof o&&(i+=a+l.name.replace(/\s/g,""),a=", ")}this.application.info(n+i),this._setPrompt(e+">")},f.prototype.captureOutput=function(t){this.captureOutputcallback=t},f.prototype.capturePrompt=function(t){this.capturePromptcallback=t},f.prototype._setPrompt=function(t){this.promptText=t},f.prototype._Output=function(t){this.captureOutputcallback&&this.captureOutputcallback(t)};var m=function(t){if(!1==this instanceof m)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String(20)"})),t.attributes.push(new e({name:"brand",type:"String"})),t.interface&&(this.setInterface(t.interface),delete t.interface),s.call(this,t),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};m.prototype=Object.create(s.prototype),s._ModelConstructor.Application=m,m.prototype.start=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("error starting application: interface not set");if("function"!=typeof t)throw new Error("callback required");var e=this;this.startcallback=t,this.presentation||(this.presentation=new g),this.primaryInterface.start(e,this.presentation,function(t){"Command"==t.type?t.command.execute():e.startcallback&&e.startcallback(t)})},m.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");return"Command"==t.type?(t.command.execute(),!0):!!this.startcallback&&(this.startcallback(t),!0)},m.prototype.setInterface=function(t){if(!1==t instanceof n)throw new Error("instance of Interface a required parameter");this.primaryInterface=t},m.prototype.getInterface=function(){return this.primaryInterface},m.prototype.setPresentation=function(t){if(!1==t instanceof g)throw new Error("instance of Presentation a required parameter");this.presentation=t},m.prototype.getPresentation=function(){return this.presentation},m.prototype.info=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.info(t)},m.prototype.done=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.done(t)},m.prototype.warn=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.warn(t)},m.prototype.err=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.err(t)},m.prototype.ok=function(t,e){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.ok(t,e)},m.prototype.yesno=function(t,e){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.yesno(t,e)},m.prototype.ask=function(t,o,r){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof o){if(!1==o instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof r)throw new Error("callback required");this.primaryInterface.ask(t,o,r)}else this.primaryInterface.ask(t,new e({name:"default"}),o)},m.prototype.choose=function(t,e,o){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof o)throw new Error("callback required");this.primaryInterface.choose(t,e,o)};var v=function(t){if(!1==this instanceof v)throw new Error("new operator required");if("string"==typeof t){var o=t;(t={}).contents=o}(t=t||{}).attributes||(t.attributes=[]);var r=t.logType||"Text",n=t.importance||"Info",i=t.contents||"(no text)";if(!E(["Text","Delta"],r))throw new Error("Unknown log type: "+r);void 0!==t.logType&&delete t.logType,void 0!==t.importance&&delete t.importance,void 0!==t.contents&&delete t.contents,t.attributes.push(new e({name:"dateLogged",type:"Date",value:new Date})),t.attributes.push(new e({name:"logType",type:"String",value:r})),t.attributes.push(new e({name:"importance",type:"String",value:n})),"Delta"==r?t.attributes.push(new e({name:"contents",type:"Object",value:i})):t.attributes.push(new e({name:"contents",type:"String",value:i})),s.call(this,t),this.modelType="Log"};v.prototype=Object.create(s.prototype),s._ModelConstructor.Log=v,v.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var g=function(t){if(!1==this instanceof g)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String"})),t.attributes.push(new e({name:"modelName",type:"String"})),t.attributes.push(new e({name:"contents",type:"Object",value:[]})),s.call(this,t),this.modelType="Presentation"};g.prototype=Object.create(s.prototype),s._ModelConstructor.Presentation=g,g.prototype.getObjectStateErrors=function(t){var r;if(this.validationErrors=s.prototype.getObjectStateErrors.call(this),!t&&0===this.validationErrors.length){var n=this.get("contents"),a=!1;if(n instanceof Array){for(r=0;r<n.length;r++)n[r]instanceof u||n[r]instanceof o||n[r]instanceof e||n[r]instanceof i||"string"==typeof n[r]||(a=!0);a&&this.validationErrors.push("contents elements must be Text, Command, Attribute, List or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},g.prototype.validate=function(t){var o,r,n=this;if("function"!=typeof t)throw new Error("callback is required");for(o in this.getObjectStateErrors(),this._errorConditions)this._errorConditions.hasOwnProperty(o)&&this.validationErrors.push(this._errorConditions[o]);var i=!1,a=0,s=0,l=this.get("contents");for(l instanceof Array||(l=[]),r=0;r<l.length;r++)l[r]instanceof e&&a++;for(r=0;r<l.length;r++)l[r]instanceof e&&l[r].validate(c);function c(){s++,this.validationMessage&&(i=!0),a==s&&(i&&n.validationErrors.push("contents has validation errors"),h())}function h(){n.validationMessage=n.validationErrors.length>0?n.validationErrors[0]:"",t()}l.length<1&&h()};var b=function(t){if(!1==this instanceof b)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]);var o=new e.ModelID(new y);t.attributes.push(new e({name:"userID",type:"Model",value:o})),t.attributes.push(new e({name:"dateStarted",type:"Date",value:new Date})),t.attributes.push(new e({name:"passCode",type:"String(20)"})),t.attributes.push(new e({name:"active",type:"Boolean"})),t.attributes.push(new e({name:"ipAddress",type:"String"})),s.call(this,t),this.modelType="Session",this.set("active",!1)};b.prototype=Object.create(s.prototype),s._ModelConstructor.Session=b,b.prototype.startSession=function(t,o,r,n,a){if(!1==t instanceof h)throw new Error("store required");if("string"!=typeof o)throw new Error("userName required");if("string"!=typeof r)throw new Error("password required");if("string"!=typeof n)throw new Error("ip required");if("function"!=typeof a)throw new Error("callback required");var s=this,l=new y;t.getList(new i(l),{name:o,password:r},function(o,r){if(r)a(r);else if(1==o.length()){for(var i="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<20;c++)i+=l.charAt(Math.floor(62*Math.random()));o.moveFirst(),o.model.set("id",o.get("id")),o.model.set("name",o.get("name")),s.set("userID",new e.ModelID(o.model)),s.set("active",!0),s.set("passCode",i),s.set("ipAddress",n),t.putModel(s,function(t,e){a(e,t)})}else a(new Error("login not found"))})},b.prototype.resumeSession=function(t,e,o,r){if(!1==t instanceof h)throw new Error("store required");if("string"!=typeof e)throw new Error("ip required");if("string"!=typeof o)throw new Error("passCode required");if("function"!=typeof r)throw new Error("callback required");var n=this;t.getList(new i(n),{ipAddress:e,passCode:o},function(t,e){e?r(e):1==t.length()?(t.moveFirst(),n.set("id",t.get("id")),n.set("userID",t.get("userID")),n.set("dateStarted",t.get("dateStarted")),n.set("passCode",t.get("passCode")),n.set("active",t.get("active")),n.set("ipAddress",t.get("ipAddress")),r(e,n)):r(new Error("session not resumed"))})},b.prototype.endSession=function(t,e){if(!1==t instanceof h)throw new Error("store required");if("function"!=typeof e)throw new Error("callback required");this.get("active")&&this.get("id")||e(this),this.set("active",!1),t.putModel(this,function(t,o){e(o,t)})};var y=function(t){if(!1==this instanceof y)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String(20)"})),t.attributes.push(new e({name:"active",type:"Boolean"})),t.attributes.push(new e({name:"password",type:"String(20)"})),t.attributes.push(new e({name:"firstName",type:"String(35)"})),t.attributes.push(new e({name:"lastName",type:"String(35)"})),t.attributes.push(new e({name:"email",type:"String(20)"})),s.call(this,t),this.modelType="User",this.set("active",!1)};function w(t){if(!1==this instanceof w)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]);var o=new e.ModelID(new y);t.attributes.push(new e({name:"user",type:"Model",value:o})),t.attributes.push(new e({name:"deltas",type:"Object",value:{}})),s.call(this,t),this.modelType="Workspace"}y.prototype=Object.create(s.prototype),s._ModelConstructor.User=y,w.prototype=Object.create(s.prototype),s._ModelConstructor.Workspace=w;var k=function(t){if(!1==this instanceof k)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"MemoryStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var e=C(t,["name","storeType"]),o=[],r=0;r<e.length;r++)o.push("invalid property: "+e[r]);if(o.length>1)throw new Error("error creating Store: multiple errors");if(o.length)throw new Error("error creating Store: "+o[0])};k.prototype=Object.create(h.prototype),k.prototype.getModel=function(t,e){var o,r;if(!(t instanceof s))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callback required");var n=-1;for(o=0;o<this.data.length;o++)this.data[o][0]==t.modelType&&(n=o);if(n<0)e(t,new Error("model not found in store"));else{var i=t.get("id"),a=this.data[n][1],l=-1;for(o=0;l<0&&o<a.length;o++)a[o][0]==i&&(l=o);if(l<0)e(t,new Error("id not found in store"));else{var c=a[l][1];for(r in t.attributes)t.attributes[r].value=c[t.attributes[r].name];e(t,void 0)}}},k.prototype.putModel=function(t,e){var o,r,n,i,a,l,c;if(!(t instanceof s))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");if(n=t.get("ID")){for(i=-1,o=0;o<this.data.length;o++)this.data[o][0]==t.modelType&&(i=o);if(i<0)return void e(t,new Error("model not found in store"));var h=-1;n=t.get("id");var u=this.data[i][1];for(o=0;h<0&&o<u.length;o++)u[o][0]==n&&(h=o);if(h<0)return void e(t,new Error("id not found in store"));for(r in a={},t.attributes)l=t.attributes[r].name,c=t.attributes[r].value,a[l]=c;u[h][1]=a,e(t,void 0)}else{for(i=-1,o=0;o<this.data.length;o++)this.data[o][0]==t.modelType&&(i=o);i<0&&(this.data.push([t.modelType,[]]),i=this.data.length-1);var d=++this.idCounter;for(r in t.set("id",d),a={},t.attributes)l=t.attributes[r].name,c=t.attributes[r].value,a[l]=c;this.data[i][1].push([d,a]),e(t,void 0)}},k.prototype.deleteModel=function(t,e){var o,r;if(!(t instanceof s))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");var n=-1;for(o=0;o<this.data.length;o++)this.data[o][0]==t.modelType&&(n=o);if(n<0)e(t,new Error("model not found in store"));else{var i=-1,a=t.get("id"),l=this.data[n][1];for(o=0;i<0&&o<l.length;o++)l[o][0]==a&&(i=o);if(i<0)e(t,new Error("id not found in store"));else{var c=l.splice(i,1)[0][1];for(r in t.attributes)"id"==t.attributes[r].name?t.attributes[r].value=void 0:t.attributes[r].value=c[t.attributes[r].name];e(t,void 0)}}},k.prototype.getList=function(t,e,o,r){var n,a,s;if("function"==typeof r?(n=r,a=o):n=o,!(t instanceof i))throw new Error("argument must be a List");if(t.view)throw new Error("List is View type use getViewList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof n)throw new Error("callback required");var l=-1;for(s=0;s<this.data.length;s++)this.data[s][0]==t.model.modelType&&(l=s);if(l<0)n(t);else{t.clear();var c=this.data[l][1];for(s=0;s<c.length;s++){var h=!0;for(var u in e)e.hasOwnProperty(u)&&(e[u]instanceof RegExp?e[u].test(c[s][1][u])||(h=!1):e[u]!=c[s][1][u]&&(h=!1));if(h){var d=[];for(var p in c[s][1])d.push(c[s][1][p]);t._items.push(d)}}t._itemIndex=t._items.length-1,a&&t.sort(a),n(t)}};var E=function(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return!0;return!1},D=function(t){if(null===t)throw new TypeError;if(Object.create)return Object.create(t);var e=typeof t;if("object"!==e&&"function"!=typeof e)throw new TypeError;function o(){}return o.prototype=t,new o},C=function(t,e){var o=[];for(var r in t)t.hasOwnProperty(r)&&(E(e,r)||o.push(r));return o},q=function(t){return s._ModelConstructor[t]||s},M=function(t){return new(q(t))},P=function(t,e){if("string"!=typeof t)throw new Error("expected CPON string");void 0===e&&(e={});var o=t.indexOf("^");if(o<0)throw new Error("caret (^) not found in garden");var r=_(t,o),n=t.substring(o+1),i=n.indexOf("|");return i>-1&&(e=P(n.substring(i+1),e),n=_(n,i)),e[r]=n,e},_=function(t,e){return t.substring(0,e)},T=function(t,e){return t.substring(t.length-e,t.length)},x=function(t,e){var o=(t.length-e)/2;return t.substring(o,o+e)},S=function(t){return t.replace(/^\s+|\s+$/g,"")},I=function(t){return t.replace(/^\s+/,"")},O=function(t){return t.replace(/\s+$/,"")},L=function(t,e,o){o=o||" ";var r=""+t;if(r.length>e)return _(r,e);for(;r.length<e;)r=o+r;return r},B=function(t,e,o){o=o||" ";var r=""+t;if(r.length>e)return T(r,e);for(;r.length<e;)r+=o;return r},A=function(t,e,o){o=o||" ";var r=""+t,n=e-r.length;if(r.length>e)return x(r,e);var i=r.length+Math.floor(n/2);return r=L(r,i,o),r=B(r,e,o)};t.INTERFACE=t.INTERFACE||{},t.INTERFACE.BOOTSTRAP=function(){return{version:"0.1.25",BootstrapInterface:H}};var H=function(t){if(!1==this instanceof n)throw new Error("new operator required");var e;(t=t||{}).name=t.name||"(unnamed)",t.description=t.description||"a BootstrapInterface",t.vendor=t.vendor||null;var o=C(t,["name","description","vendor"]),r=[];for(e=0;e<o.length;e++)r.push("invalid property: "+o[e]);if(r.length>1)throw new Error("error creating Interface: multiple errors");if(r.length)throw new Error("error creating Interface: "+r[0]);for(e in this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.doc={},t)this[e]=t[e]};H.prototype=Object.create(n.prototype),H.prototype.canMock=function(){return!!this.vendor},H.prototype.start=function(t,e,o){if(!(t instanceof m))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof o)throw new Error("callback required");if(this.application=t,this.presentation=e,this.startcallback=o,!this.vendor)throw new Error("Error initializing Bootstrap");try{H._bs||(H._bs=new this.vendor)}catch(t){throw new Error("Error initializing Bootstrap: "+t)}this.htmlPanels(),this.htmlDialog(),this.presentation.get("contents").length&&this.htmlNavigation()},H.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");var o=!1;try{this.application&&("Command"==t.type&&"Presentation"==t.command.type?(t.command.execute(this),o=!0):o=this.application.dispatch(t)),!o&&this.startcallback&&this.startcallback(t)}catch(t){this.startcallback&&this.startcallback(t)}},H.prototype.render=function(t,e){if(!1==t instanceof o)throw new Error("Command object required");this.activatePanel(t)},H.addEle=function(t,e,o,r){var n=document.createElement(e);if(o&&o.length&&(n.className=o),r)for(var i in r)r.hasOwnProperty(i)&&n.setAttribute(i,r[i]);return t.appendChild(n),n},H.addTopEle=function(t,e,o,r){var n=document.createElement(e);if(o&&o.length&&(n.className=o),r)for(var i in r)r.hasOwnProperty(i)&&n.setAttribute(i,r[i]);return t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n},H.prototype.htmlNavigation=function(){var t=H.addEle;this.doc.navBar=t(document.body,"nav","navbar navbar-default navbar-fixed-top");var e=t(this.doc.navBar,"div","container");this.doc.navBarHeader=t(e,"div","navbar-header");var o=t(this.doc.navBarHeader,"button","navbar-toggle collapsed",{"data-toggle":"collapse","data-target":"#navbar","aria-expanded":"false","aria-controls":"navbar"});t(o,"span","icon-bar"),t(o,"span","icon-bar"),t(o,"span","icon-bar"),this.doc.navBarBody=t(e,"div","navbar-collapse collapse",{id:"navbar"}),this.doc.navBarAlert=t(e,"div","container",{style:"margin:0"}),this.refreshNavigation()},H.prototype.refreshNavigation=function(){this.doc.navBarBody.innerHTML="";var t=H.addEle;this.doc.navBarLeft=t(this.doc.navBarBody,"ul","nav navbar-nav"),this.doc.navBarRight=t(this.doc.navBarBody,"ul","nav navbar-nav navbar-right"),t(this.doc.navBarHeader,"a","navbar-brand").innerHTML='<a href="#">'+this.application.get("brand")+"</a>";var e=this.presentation.get("contents"),o=!1;for(var r in e)if(e.hasOwnProperty(r))if("Menu"==e[r].type){var n=this.addNavBarListMenu(this.doc.navBarLeft,e[r]),i=e[r].contents;for(var a in i)i.hasOwnProperty(a)&&this.addNavBarListItem(n,i[a])}else"-"==e[r]?o=!0:this.addNavigationItem(o?this.doc.navBarRight:this.doc.navBarLeft,e[r])},H.prototype.addNavigationItem=function(t,e){var o=this,r=H.addEle(t,"li"),n="",i=e.theme||"default";e.icon&&(n="fa"==_(e.icon,2)?'<i class="fa '+e.icon+'"></i>&nbsp;':'<span class="glyphicon '+e.icon+'"></span>&nbsp;'),r.innerHTML='<button type="button" class="btn btn-'+i+' navbar-btn">'+n+e.name+"</button>",$(r).click(function(t){o.dispatch(new c({type:"Command",command:e})),t.preventDefault()})},H.prototype.addNavBarListItem=function(t,e,r){var n,i=this,a=document.createElement("li");r=r||"",e instanceof o?(n="<a>"+r+e.name+"</a>",$(a).click(function(t){i.dispatch(new c({type:"Command",command:e})),t.preventDefault()})):"-"==e?a.className="divider":(a.className="dropdown-header",n=e),a.innerHTML=n,t.appendChild(a)},H.prototype.addNavBarListMenu=function(t,e){var o="",r=e.theme||"default";e.icon&&(o="fa"==_(e.icon,2)?'<i class="fa '+e.icon+'"></i>&nbsp;':'<span class="glyphicon '+e.icon+'"></span>&nbsp;');var n=document.createElement("li");n.className="dropdown",n.innerHTML='<button type="button" class="dropdown-toggle btn btn-'+r+' navbar-btn" data-toggle="dropdown">'+o+e.name+'&nbsp;<b class="caret"></b></button>',t.appendChild(n);var i=document.createElement("ul");return i.className="dropdown-menu",n.appendChild(i),i},H.prototype.htmlPanels=function(){var t=H.addEle;this.doc.mainContainer=t(document.body,"div","container main-container",{role:"main"}),this.doc.panelRow=t(this.doc.mainContainer,"div","row")},H.prototype.activatePanel=function(t){var e=this,o=H.addEle,r=H.addTopEle,n=t.contents.get("name")||t.name,i=t.theme||"default",a=t.icon;a&&(a="fa"==_(a,2)?'<i class="fa '+a+'"></i>&nbsp;':'<span class="glyphicon '+a+'"></span>&nbsp;');var s,l=a?a+n:n;void 0===this.panels&&(this.panels=[]);for(var c=0;void 0===s&&c<this.panels.length;c++)n==this.panels[c].name&&(s=this.panels[c]);void 0!==s&&(e.destroyPanel(s),s=void 0),void 0===s&&(s={name:n,listeners:[],attributeListeners:[],textListeners:[]},this.panels.push(s),s.panelDiv=r(this.doc.panelRow,"div","panel panel-"+i),s.panelHeading=o(s.panelDiv,"div","panel-heading"),s.panelTitle=o(s.panelHeading,"div","panel-title"),s.panelTitleText=o(s.panelTitle,"a","panel-title-text",{href:"#"}),s.panelTitleText.innerHTML=l,s.panelBody=o(s.panelDiv,"div","panel-body bg-"+i),s.panelWell=o(s.panelBody,"div","well-panel"),s.panelForm=o(s.panelWell,"form","form-horizontal"),s.panelClose=o(s.panelTitle,"a",void 0,{href:"#"}),s.panelClose.innerHTML='<span class="glyphicon glyphicon-remove panel-glyph-right pull-right text-muted"></span>',$(s.panelClose).click(function(t){e.destroyPanel(s),t.preventDefault()}),s.listeners.push(s.panelClose),s.panelHide=o(s.panelTitle,"a",void 0,{href:"#"}),s.panelHide.innerHTML='<span class="glyphicon glyphicon-chevron-down panel-glyph-right pull-right text-muted"></span>',$(s.panelHide).click(function(t){$(s.panelBody).hide("fast"),$(s.panelHide).hide(),$(s.panelShow).show(),t.preventDefault()}),s.listeners.push(s.panelHide),s.panelShow=o(s.panelTitle,"a",void 0,{href:"#"}),s.panelShow.innerHTML='<span class="glyphicon glyphicon-chevron-left panel-glyph-right pull-right text-muted"></span>',$(s.panelShow).hide(),$(s.panelShow).click(function(t){$(s.panelBody).show("fast"),$(s.panelHide).show(),$(s.panelShow).hide(),t.preventDefault()}),s.listeners.push(s.panelShow)),e.renderPanelBody(s,t),$(s.panelBody).show("fast"),$(s.panelHide).show(),$(s.panelShow).hide(),$("html, body").animate({scrollTop:$(s.panelDiv).offset().top-$(e.doc.navBar).height()-8},250)},H.prototype.destroyPanel=function(t){var e,o,r=this;for(e=0;e<r.panels.length;e++)t==r.panels[e]&&r.panels.splice(e,1);for(e=0;e<t.listeners.length;e++)o=t.listeners[e],$(o).off();for(e=0;e<t.attributeListeners.length;e++)(o=t.attributeListeners[e]).offEvent();for(e=0;e<t.textListeners.length;e++)(o=t.textListeners[e]).offEvent();$("html, body").stop(),$(t.panelDiv).remove()},H.prototype.renderPanelBody=function(t,r){var n,a,s=this,l=H.addEle,h=!1,d=r.contents.get("contents");for(t.buttonDiv=null,$(t.panelForm).empty(),n=0;n<d.length;n++){if("string"==typeof d[n])switch(d[n]){case"-":t.panelForm.appendChild(document.createElement("hr"));break;case">":h=!0;break;case"<":h=!1;break;default:l(t.panelForm,"div",h?"col-sm-offset-3":"").innerHTML=marked(d[n])}d[n]instanceof u&&p(d[n]),d[n]instanceof e&&f(d[n],r.presentationMode),d[n]instanceof i&&m(d[n],r.theme),d[n]instanceof o&&v(d[n])}function p(e){var o=l(t.panelForm,"div",h?"col-sm-offset-3":"");o.innerHTML=marked(e.get()),e.onEvent("StateChange",function(){o.innerHTML=marked(e.get())}),t.textListeners.push(e)}function f(e,o){var r,n,i,a,s,c,h,u,d,p,f,m;switch(i=l(t.panelForm,"div","form-group"),l(i,"label","col-sm-3 control-label").innerHTML=e.label,h="1",e.size>2&&(h="2"),e.size>5&&(h="3"),e.size>10&&(h="4"),e.size>20&&(h="5"),e.size>25&&(h="6"),e.size>30&&(h="7"),e.size>40&&(h="8"),e.size>50&&(h="9"),"Number"==e.type&&(h="3"),"Date"==e.type&&(h="3"),"Boolean"==e.type&&(h="3"),a=l(i,"div","col-sm-"+h),o+e.type){case"ViewBoolean":(s=l(a,"input","js-switch")).setAttribute("type","checkbox"),e.value&&s.setAttribute("checked","true"),new Switchery(s,{color:"#5bc0de",secondaryColor:"#dfdfdf",className:"switchery",disabled:!0,disabledOpacity:.5,speed:"0.1s"}),$(s).on("change",function(){e.value=s.checked});break;case"EditBoolean":(s=l(a,"input","js-switch")).setAttribute("type","checkbox"),e.value&&s.setAttribute("checked","true"),new Switchery(s,{color:"#5bc0de",secondaryColor:"#dfdfdf",className:"switchery",disabled:!1,disabledOpacity:.5,speed:"0.1s"}),$(s).on("change",function(){e.value=s.checked});break;case"EditDate":u=l(a,"div","input-group date"),s=l(u,"input","form-control"),e.placeHolder&&s.setAttribute("placeHolder",e.placeHolder),e.value&&(s.value=1+e.value.getMonth()+"/"+e.value.getDate()+"/"+e.value.getFullYear()),(d=l(u,"span","input-group-addon")).innerHTML='<i class="fa fa-calendar"></i>',$(u).datepicker({autoclose:!0,todayBtn:!0,todayHighlight:!0,showOnFocus:!1}).on("hide",function(t){v(),t.preventDefault()}),t.listeners.push(u);break;case"EditNumber":s=l(a,"input","form-control"),e.placeHolder&&s.setAttribute("placeHolder",e.placeHolder),s.setAttribute("type","number"),s.setAttribute("maxlength",e.size),s.setAttribute("value",e.value?e.value:0);break;case"EditString":if(e.quickPick?(u=l(a,"div","input-group"),s=l(u,"input","form-control")):s=l(a,"input","form-control"),e.placeHolder&&s.setAttribute("placeHolder",e.placeHolder),s.setAttribute("type",e.hint.password?"password":"text"),s.setAttribute("maxlength",e.size),e.value&&s.setAttribute("value",e.value),e.quickPick){for(d=l(u,"span","input-group-btn"),(p=l(d,"button","btn btn-default dropdown-toggle")).type="button",p.setAttribute("data-toggle","dropdown"),p.innerHTML='<span class="caret"></span>',n=e.quickPick,r="",m=0;m<n.length;m++)r+='<li><a href="#">'+n[m]+"</a></li>";(f=l(d,"ul","dropdown-menu pull-right")).innerHTML=r,$(f).click(function(t){s.value=t.originalEvent.srcElement.innerText,v(),t.preventDefault()}),t.listeners.push(f)}break;case"ViewDate":s=l(a,"p","form-control-static"),e.value&&(s.innerHTML=1+e.value.getMonth()+"/"+e.value.getDate()+"/"+e.value.getFullYear());break;default:(s=l(a,"p","form-control-static")).innerHTML=e.value}var v=function(t){switch(e.type){case"Date":if(e.value=""===s.value?null:e.coerce(s.value),null!=e.value){var o=e.value.getMonth()+1,r=e.value.getDate(),n=e.value.getFullYear();o<10&&(o="0"+o),r<10&&(r="0"+r),s.value=o+"/"+r+"/"+n}else s.value="";break;case"Number":console.log(`validateInput ${e.type} '${s.value}'`),isNaN(s.value)||""===s.value.trim()?(e.value=null,s.value=""):(e.value=Number(s.value),s.value=e.value);break;default:e.value=""===s.value?null:e.coerce(s.value),null!=e.value&&(s.value=e.value)}e.validate(function(){})};$(s).on("focusout",v),t.listeners.push(s),e.onEvent("Validate",function(){e._validationDone=!0}),e.onEvent("StateChange",function(){switch(o+e.type){case"EditBoolean":!!e.value!=s.checked&&$(s).click();break;case"EditDate":s.value=e.value?1+e.value.getMonth()+"/"+e.value.getDate()+"/"+e.value.getFullYear():"";break;case"EditNumber":"number"==typeof e.value?s.value=e.value:s.value="";break;case"EditString":s.value=e.value?""+e.value:"";break;case"ViewDate":s.innerHTML=e.value?1+e.value.getMonth()+"/"+e.value.getDate()+"/"+e.value.getFullYear():"";break;default:s.innerHTML=e.value}var t;(t=e._validationDone?e.validationMessage:"")?(c||((c=document.createElement("div")).className="col-sm-9 col-sm-offset-3 has-error",i.appendChild(c)),c.innerHTML='<span style="display: block;" class="help-block">'+t+"</span>",$(i).addClass("has-error"),p&&$(p).addClass("btn-danger")):(setTimeout(function(){c&&($(c).remove(),c=null)},250),$(i).removeClass("has-error"),p&&$(p).removeClass("btn-danger")),e._validationDone=!1}),t.attributeListeners.push(e)}function m(e,o){var r=document.createElement("table");r.className="table table-condensed table-bordered table-hover-"+o;var n=l(r,"thead"),i=l(n,"tr");for(a=1;a<e.model.attributes.length;a++){var s=e.model.attributes[a];null==s.hidden&&(l(i,"th").innerHTML=s.label)}for(var c=e.moveFirst(),h=l(r,"tbody");c;){var u=l(h,"tr"),d=e.model.attributes[0];for($(u).data("id",e.get(d.name)),$(u).click(function(t){e.pickKludge&&e.pickKludge($(t.currentTarget).data("id")),t.preventDefault()}),a=1;a<e.model.attributes.length;a++){var p=e.model.attributes[a];if(null==p.hidden){var f=e.get(p.name);switch(p.type){case"Date":l(u,"td").innerHTML=f?_(f.toISOString(),10):"&nbsp;";break;case"Boolean":l(u,"td").innerHTML=f?'<i class="fa fa-check-square-o"></i>':'<i class="fa fa-square-o"></i>';break;case"Number":console.log("*** NUNBER *** dValue="+f+" typeof="+typeof f+" JSON="+JSON.stringify(f)),"number"!=typeof f&&(f=null),l(u,"td").innerHTML=f;break;default:f&&f.name?l(u,"td").innerHTML=f.name:l(u,"td").innerHTML=null==f?"":f}}}c=e.moveNext()}t.panelForm.appendChild(r)}function v(e){if(!t.buttonDiv){var o=l(t.panelForm,"div","form-group");t.buttonDiv=l(o,"div",h?"col-sm-offset-3 col-sm-9":"col-sm-9")}var r=e.theme||"default",n=l(t.buttonDiv,"button","btn btn-"+r+" btn-presentation",{type:"button"}),i=e.icon;i?(i="fa"==_(i,2)?'<i class="fa '+i+'"></i>&nbsp;':'<span class="glyphicon '+i+'"></span>&nbsp;',n.innerHTML=i+e.name):n.innerHTML=e.name,$(n).on("click",function(t){t.preventDefault(),s.dispatch(new c({type:"Command",command:e}))}),t.listeners.push(n)}},H.prototype.htmlDialog=function(){var t,e,o,r,n,i,a,s,l,c,h=this,u=H.addEle;this.doc.okDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.okDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),o=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.okDialogTitle=u(o,"h4","modal-title",{style:"text-align: center"}),this.doc.okDialogBody=u(e,"div","modal-body",{style:"text-align: center"}),n=u(e,"div","modal-footer",{style:"text-align: center"}),(i=u(n,"button","btn btn-primary")).innerHTML="&nbsp;&nbsp;OK&nbsp;&nbsp;",$(i).on("click",function(){$(h.doc.okDialog).modal("hide")}),$(this.doc.okDialog).on("hidden.bs.modal",function(t){if(h.okcallback){var e=h.okcallback;delete h.okcallback,e()}}),this.doc.yesnoDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.yesnoDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),o=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.yesnoDialogTitle=u(o,"h4","modal-title",{style:"text-align: center"}),this.doc.yesnoDialogBody=u(e,"div","modal-body",{style:"text-align: center"}),n=u(e,"div","modal-footer",{style:"text-align: center"}),(s=u(n,"button","btn btn-success")).innerHTML="&nbsp;<u>Y</u>es&nbsp;",$(s).on("click",function(){$(h.doc.yesnoDialog).modal("hide"),h.yesnoResponse=!0}),(l=u(n,"button","btn btn-danger")).innerHTML="&nbsp;<u>N</u>o&nbsp;&nbsp;",$(l).on("click",function(){$(h.doc.yesnoDialog).modal("hide"),h.yesnoResponse=!1}),$(this.doc.yesnoDialog).on("hidden.bs.modal",function(t){if(h.yesnocallback){var e=h.yesnocallback;delete h.yesnocallback,e(h.yesnoResponse)}}),this.doc.askDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.askDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),o=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.askDialogTitle=u(o,"h4","modal-title",{style:"text-align: center"}),r=u(e,"div","modal-body",{style:"text-align: center"}),this.doc.askDialogPrompt=u(r,"div","modal-body"),this.doc.askDialogInput=u(r,"input","form-control",{style:"margin:0 auto; width:80%;"}),$(this.doc.askDialogInput).keypress(function(t){13==t.which&&(h.askResponse=h.doc.askDialogInput.value,$(h.doc.askDialog).modal("hide"))}),n=u(e,"div","modal-footer",{style:"text-align: center"}),(i=u(n,"button","btn btn-primary")).innerHTML="&nbsp;&nbsp;OK&nbsp;&nbsp;",$(i).on("click",function(){h.askResponse=h.doc.askDialogInput.value,$(h.doc.askDialog).modal("hide")}),(a=u(n,"button","btn btn-default")).innerHTML="Cancel",$(a).on("click",function(){h.askResponse=void 0,$(h.doc.askDialog).modal("hide")}),$(this.doc.askDialog).on("hidden.bs.modal",function(t){if(h.askcallback){var e=h.askcallback;delete h.askcallback,e(h.askResponse)}}),$(this.doc.askDialog).on("shown.bs.modal",function(t){$(h.doc.askDialog).focus(),$(h.doc.askDialogInput).focus()}),this.doc.chooseDialog=u(document.body,"div","modal fade",{tabindex:"-1",role:"dialog","aria-hidden":!0}),t=u(this.doc.chooseDialog,"div","modal-dialog"),e=u(t,"div","modal-content"),o=u(e,"div","modal-header",{style:"text-align: center"}),this.doc.chooseDialogTitle=u(o,"h4","modal-title",{style:"text-align: center"}),r=u(e,"div","modal-body",{style:"text-align: center"}),this.doc.chooseDialogPrompt=u(r,"div","modal-body",{style:"text-align: center"}),this.doc.chooseDialogButtons=[],c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=0,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=1,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=2,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=3,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=4,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=5,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=6,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=7,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=8,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=9,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=10,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=11,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=12,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=13,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=14,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=15,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=16,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=17,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=18,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=19,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),c=u(r,"button","btn btn-default btn-block"),$(c).on("click",function(){h.doc.chooseDialogChoice=20,$(h.doc.chooseDialog).modal("hide")}),this.doc.chooseDialogButtons.push(c),n=u(e,"div","modal-footer",{style:"text-align: center"}),(a=u(n,"button","btn btn-default btn-block")).innerHTML='<b class="text-danger">Cancel</b>',$(a).on("click",function(){h.doc.chooseDialogChoice=void 0,$(h.doc.chooseDialog).modal("hide")}),$(this.doc.chooseDialog).on("hidden.bs.modal",function(t){if(h.choosecallback){var e=h.choosecallback;delete h.choosecallback,e(h.doc.chooseDialogChoices[h.doc.chooseDialogChoice])}})},H.prototype.info=function(t){var e=$.notify({icon:"glyphicon glyphicon-info-sign",title:"Information",message:t},{element:"body",position:null,type:"info",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:this.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){e.close()},3e3)},H.prototype.done=function(t){var e=$.notify({icon:"glyphicon glyphicon-saved",title:"Done",message:t},{element:"body",position:null,type:"success",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:this.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){e.close()},3e3)},H.prototype.warn=function(t){var e=$.notify({icon:"glyphicon glyphicon-exclamation-sign",title:"Warning",message:t},{element:"body",position:null,type:"warning",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:this.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){e.close()},3e3)},H.prototype.err=function(t){var e=$.notify({icon:"glyphicon glyphicon-warning-sign",title:"Error",message:t},{element:"body",position:null,type:"danger",allow_dismiss:!0,newest_on_top:!0,placement:{from:"top",align:"right"},offset:{x:20,y:this.doc.navBarHeader.offsetHeight+20},spacing:10,z_index:1031,delay:0,timer:1e3,mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-6 alert alert-notify alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button><h4><span data-notify="icon"></span> <span data-notify="title">{1}</span></h4><span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div></div>'});setTimeout(function(){e.close()},3e3)},H.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):(this.doc.okDialogTitle.innerHTML=this.application?this.application.get("brand"):"?",this.doc.okDialogBody.innerHTML=t,$(this.doc.okDialog).modal(),this.okcallback=e)},H.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):(this.doc.yesnoDialogTitle.innerHTML=this.application.get("brand"),this.doc.yesnoDialogBody.innerHTML=t,$(this.doc.yesnoDialog).modal(),this.yesnocallback=e)},H.prototype.ask=function(t,o,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==o instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof r)throw new Error("callback required");this.askPending?(delete this.askPending,r(this.askResponse)):(this.doc.askDialogTitle.innerHTML=this.application.get("brand"),this.doc.askDialogPrompt.innerHTML=t+"<br><br>",this.doc.askDialogInput.value=o.value,$(this.doc.askDialog).modal(),this.askcallback=r)},H.prototype.choose=function(t,e,o){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof o)throw new Error("callback required");if(this.choosePending)delete this.choosePending,o(n.firstMatch(this.chooseResponse,e));else{if(e.length>this.doc.chooseDialogButtons.length)throw new Error("max choices reached in choose");this.doc.chooseDialogTitle.innerHTML=this.application.get("brand"),this.doc.chooseDialogPrompt.innerHTML=t.replace(/\n/g,"<br>"),$(this.doc.chooseDialog).modal(),this.choosecallback=o,this.doc.chooseDialogChoices=e;for(var r=0;r<this.doc.chooseDialogButtons.length;r++)r<e.length?(this.doc.chooseDialogButtons[r].innerHTML='<b class="text-primary">'+e[r]+"</b>",$(this.doc.chooseDialogButtons[r]).show()):$(this.doc.chooseDialogButtons[r]).hide()}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.TGI=t):this.TGI=t}).call(this);